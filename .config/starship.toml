# Starship prompt configuration
# https://starship.rs/config/

# Get editor completions based on the config schema
"$schema" = 'https://starship.rs/config-schema.json'

add_newline = false

format = '${custom.github_repo_base}${custom.worktree_branch}$directory$character'
right_format = '$cmd_duration$git_branch$git_status'

[character]
success_symbol = "[❯](bold green)"
error_symbol = "[❯](bold red)"

# Custom module to show org/repo for github paths (left side)
[custom.github_repo_base]
when = """ [[ $PWD == "$HOME/github/"*/* ]] && git rev-parse --is-inside-work-tree >/dev/null 2>&1 """
command = '''
relative="${PWD#$HOME/github/}"
org=$(echo "$relative" | cut -d'/' -f1)
full_repo=$(echo "$relative" | cut -d'/' -f2)

# Detect worktree: repo--branch pattern
if [[ "$full_repo" == *"--"* ]]; then
  repo="${full_repo%%--*}"
  printf '%s/%s' "$org" "$repo"
else
  printf '%s/%s' "$org" "$full_repo"
fi
'''
format = '[github\([$output]($style bold underline)\)]($style italic) '
style = "green"

# Custom module to show worktree name (left side, after github module)
[custom.worktree_branch]
when = """ [[ $PWD == "$HOME/github/"*/* ]] && [[ "$(echo "${PWD#$HOME/github/}" | cut -d'/' -f2)" == *"--"* ]] """
command = '''
relative="${PWD#$HOME/github/}"
full_repo=$(echo "$relative" | cut -d'/' -f2)

if [[ "$full_repo" == *"--"* ]]; then
  branch="${full_repo#*--}"
  printf '%s' "$branch"
fi
'''
format = '[{$output}](bold yellow) '
style = "yellow"

[git_branch]
symbol = " "
style = "bold purple"
format = '[$symbol$branch]($style) '

[git_status]
format = '([$all_status$ahead_behind]($style) )'
style = "yellow"
ahead = "⇡${count}"
behind = "⇣${count}"
diverged = "⇕⇡${ahead_count}⇣${behind_count}"
conflicted = "="
untracked = "?"
stashed = "\\$"
modified = "!"
staged = "+"
renamed = "»"
deleted = "✘"

[cmd_duration]
min_time = 2_000
format = '[$duration]($style) '
style = "dimmed yellow"

[directory]
truncate_to_repo = true
repo_root_format = '[$path]($style)[$read_only]($read_only_style) '
repo_root_style = "cyan bold"
